<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Products</title>
  <style>body{font-family:Arial;padding:20px} .product{border:1px solid #ddd;padding:10px;margin:8px 0} .filters{margin-bottom:12px}</style>
</head>
<body>
  <h1>Products</h1>
  <form method="get" action="/products" class="filters">
    <label>Category:
      <select name="category">
        <option value="">All</option>
        <% categories.forEach(function(cat){ %>
          <option value="<%= cat %>" <%= (filters.category===cat)?'selected':'' %>><%= cat %></option>
        <% }) %>
      </select>
    </label>
    <label>Min price: <input name="minPrice" type="number" step="0.01" value="<%= filters.minPrice || '' %>"></label>
    <label>Max price: <input name="maxPrice" type="number" step="0.01" value="<%= filters.maxPrice || '' %>"></label>
    <label>Per page: <input name="limit" type="number" value="<%= limit %>" style="width:60px"></label>
    <button type="submit">Apply</button>
  </form>

  <div>
    <% if (products.length===0) { %>
      <p>No products found.</p>
    <% } %>
    <% products.forEach(function(p){ %>
      <div class="product">
        <h3><%= p.name %>  $<%= Number(p.price).toFixed(2) %></h3>
        <div><strong>Category:</strong> <%= p.category %></div>
        <div><%= p.description || '' %></div>
      </div>
    <% }) %>
  </div>

  <div>
    <% function qs(page){
         var q = '?page='+page+'&limit='+limit;
         if(filters.category) q += '&category=' + encodeURIComponent(filters.category);
         if(filters.minPrice) q += '&minPrice=' + encodeURIComponent(filters.minPrice);
         if(filters.maxPrice) q += '&maxPrice=' + encodeURIComponent(filters.maxPrice);
         return q;
       }
    %>
    <% if (currentPage > 1) { %>
      <a href="/products<%= qs(currentPage-1) %>">Previous</a>
    <% } %>
    <span> Page <%= currentPage %> of <%= totalPages %> </span>
    <% if (currentPage < totalPages) { %>
      <a href="/products<%= qs(currentPage+1) %>">Next</a>
    <% } %>
  </div>
</body>
</html>
